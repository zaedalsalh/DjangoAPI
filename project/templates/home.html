<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  --secondary-gradient: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
  --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  --dark-bg: #1e1e2d;
  --sidebar-width: 280px;
}

body { 
  background-color: #f5f6fa; 
  font-family: "Cairo", sans-serif;
  transition: all 0.3s ease;
}

/* الشريط الجانبي */
#sidebar { 
  width: var(--sidebar-width); 
  background: var(--dark-bg); 
  color: white; 
  min-height: 100vh; 
  position: fixed; 
  top: 0; 
  right: 0; 
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
  z-index: 1050;
  box-shadow: 5px 0 25px rgba(0,0,0,0.15);
  background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23495057' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
}

#sidebar .nav-link { 
  color: rgba(255, 255, 255, 0.85); 
  transition: all 0.2s; 
  padding: 12px 20px; 
  border-radius: 8px; 
  margin-bottom: 5px; 
  font-weight: 500;
  position: relative;
  overflow: hidden;
}

#sidebar .nav-link::before {
  content: '';
  position: absolute;
  top: 0;
  right: -10px;
  width: 4px;
  height: 100%;
  background: var(--primary-gradient);
  opacity: 0;
  transition: all 0.3s ease;
}

#sidebar .nav-link.active, #sidebar .nav-link:hover { 
  background-color: rgba(255, 255, 255, 0.1); 
  color: white;
  transform: translateX(-5px);
}

#sidebar .nav-link.active::before, #sidebar .nav-link:hover::before {
  opacity: 1;
  right: 0;
}

#sidebar .nav-link i {
  margin-left: 10px;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

#sidebar .nav-link.active i, #sidebar .nav-link:hover i {
  transform: scale(1.2);
}

.content { 
  margin-right: var(--sidebar-width); 
  padding: 20px; 
  transition: all 0.3s ease; 
}

#sidebarToggle { 
  position: fixed; 
  top: 20px; 
  right: 20px; 
  z-index: 1100; 
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primary-gradient);
  color: white;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

#sidebarToggle:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.card-stat, .chart-card, .review-card { 
  border-radius: 1rem; 
  transition: transform 0.3s ease, box-shadow 0.3s ease; 
  border: none;
  overflow: hidden;
  position: relative;
}

.card-stat::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 100%;
  height: 5px;
  background: var(--primary-gradient);
}

.card-stat:nth-child(2)::before {
  background: var(--success-gradient);
}

.card-stat:nth-child(3)::before {
  background: var(--warning-gradient);
}

.card-stat:nth-child(4)::before {
  background: var(--secondary-gradient);
}

.card-stat:hover, .review-card:hover { 
  transform: translateY(-10px) scale(1.03); 
  box-shadow: 0 15px 30px rgba(0,0,0,0.15) !important; 
}

.chart-card { 
  display: flex; 
  flex-direction: column; 
  justify-content: space-between; 
  min-height: 350px; 
  background: white;
  box-shadow: 0 10px 20px rgba(0,0,0,0.05);
}

.rating-stars i { 
  color: #ffc107; 
  font-size: 1.2rem; 
  transition: all 0.3s ease;
}

.rating-stars i:hover {
  transform: scale(1.3);
}

.table thead { 
  background: var(--primary-gradient); 
  color: white; 
}

.table th {
  border: none;
  font-weight: 600;
  padding: 15px 10px;
}

.table td {
  padding: 12px 10px;
  vertical-align: middle;
  border-color: #f1f1f1;
}

.modal-header { 
  background: var(--primary-gradient); 
  color: white; 
  border-radius: 1rem 1rem 0 0;
  border: none;
  padding: 1.2rem;
}

.modal-content {
  border-radius: 1rem;
  border: none;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.btn {
  border-radius: 0.75rem;
  padding: 0.5rem 1.5rem;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 15px rgba(0,0,0,0.15);
}

.bg-gradient-primary { background: var(--primary-gradient) !important; }
.bg-gradient-success { background: var(--success-gradient) !important; }
.bg-gradient-warning { background: var(--warning-gradient) !important; }
.bg-gradient-danger { background: var(--secondary-gradient) !important; }

.card-stat {
  background: white;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}

.card-stat i {
  font-size: 2.5rem;
  margin-bottom: 15px;
  background: var(--primary-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  transition: all 0.3s ease;
}

.card-stat:hover i {
  transform: scale(1.2) rotate(5deg);
}

.card-stat:nth-child(2) i {
  background: var(--success-gradient);
  -webkit-background-clip: text;
}

.card-stat:nth-child(3) i {
  background: var(--warning-gradient);
  -webkit-background-clip: text;
}

.card-stat:nth-child(4) i {
  background: var(--secondary-gradient);
  -webkit-background-clip: text;
}

/* تأثيرات النص */
h3, h4, h5, h2 {
  font-weight: 700;
}

h3 {
  position: relative;
  padding-bottom: 15px;
}

h3::after {
  content: '';
  position: absolute;
  bottom: 0;
  right: 0;
  width: 70px;
  height: 4px;
  background: var(--primary-gradient);
  border-radius: 2px;
}

/* تحسينات للجداول */
.table-hover tbody tr {
  transition: all 0.3s ease;
}



/* تحسينات للرسوم البيانية */
.chart-container {
  position: relative;
  height: 300px;
  width: 100%;
}

/* تحسينات متجاوبة */
@media (max-width: 991px) { 
  #sidebar { 
    right: calc(var(--sidebar-width) * -1); 
    transform: translateX(0);
  } 
  #sidebar.show { 
    right: 0; 
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
  } 
  .content { 
    margin-right: 0; 
  } 
}

@media (max-width: 768px) {
  .card-stat {
    margin-bottom: 20px;
  }
  
  .chart-card {
    margin-bottom: 20px;
  }
  
  h3::after {
    width: 50px;
  }
}

/* تأثيرات دخول الصفحة */
.section-content {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.5s ease;
}

.section-active {
  opacity: 1;
  transform: translateY(0);
}

/* تأثيرات للبطاقات */
.review-card {
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  border: none;
  transition: all 0.3s ease;
  border-radius: 1rem;
  overflow: hidden;
}

.review-card::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  width: 100%;
  height: 5px;
  background: var(--warning-gradient);
  opacity: 0.7;
}

/* تحسينات للأزرار داخل البطاقات */
.review-card .btn {
  padding: 0.4rem 1rem;
  font-size: 0.85rem;
}

/* تحسينات للشريط الجانبي */
.sidebar-header {
  padding: 1.5rem 1rem;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 1rem;
}

.sidebar-brand {
  font-weight: 700;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sidebar-brand i {
  margin-left: 10px;
  background: var(--primary-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* تأثيرات النص المتلألئة */
.glowing-text {
  text-shadow: 0 0 10px rgba(255,255,255,0.8);
  animation: glow 2s infinite alternate;
}

@keyframes glow {
  from {
    text-shadow: 0 0 5px rgba(255,255,255,0.5);
  }
  to {
    text-shadow: 0 0 15px rgba(255,255,255,0.8);
  }
}

/* تأثيرات التحميل */
.skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  border-radius: 4px;
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* تأثيرات الظل */
.deep-shadow {
  box-shadow: 0 10px 30px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.07);
}

/* تأثيرات للرسم البياني */
.chart-tooltip {
  position: absolute;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 12px;
  pointer-events: none;
  z-index: 100;
  opacity: 0;
  transition: opacity 0.3s;
}

/* تحسينات للوضع الليلي */
body.dark-mode {
  background-color: #121212;
  color: #e0e0e0;
  .text-muted{
    color: #e0e0e0 !important;
  }
}

body.dark-mode .card,
body.dark-mode .chart-card,
body.dark-mode .modal-content {
  background-color: #1e1e1e;
  color: #e0e0e0;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}

body.dark-mode .table  {
  color: #e0e0e0;
}

body.dark-mode .table-hover tbody tr:hover {
  background-color: rgba(255, 255, 255, 0.05);
}

/* زر تبديل الوضع الليلي */
.theme-switch {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 1000;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primary-gradient);
  color: white;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: all 0.3s ease;
}

.theme-switch:hover {
  transform: scale(1.1) rotate(30deg);
}
</style>
</head>
<body>

<button class="btn btn-primary d-lg-none" id="sidebarToggle"><i class="bi bi-list"></i></button>

<div id="sidebar">
    <div class="sidebar-header">
        <h4 class="sidebar-brand"><i class="bi bi-stars"></i> لوحة التحكم</h4>
    </div>
    <div class="p-3">
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link active" onclick="showSection('home')"><i class="bi bi-house-door-fill"></i> الرئيسية</a></li>
            <li class="nav-item"><a class="nav-link" href="#users"  onclick="showSection('users')"><i class="bi bi-people-fill"></i> المستخدمين</a></li>
            <li class="nav-item"><a class="nav-link" href="#requests" onclick="showSection('requests')"><i class="bi bi-clipboard-check"></i> الطلبات</a></li>
            <li class="nav-item"><a class="nav-link" href="#ratings" onclick="showSection('ratings')"><i class="bi bi-star-fill"></i> التقييمات</a></li>
            <li class="nav-item"><a class="nav-link" href="#notifications" onclick="showSection('notifications')"><i class="bi bi-bell-fill"></i> الإشعارات</a></li>
        </ul>
    </div>
</div>

<div class="theme-switch" onclick="toggleDarkMode()">
    <i class="bi bi-moon-fill" id="theme-icon"></i>
</div>

<div class="content">

<!-- Home -->
<div id="homeSection" class="section-content section-active">
    <h3 class="mb-4 text-primary"><i class="bi bi-house-door-fill"></i> الرئيسية</h3>
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card card-stat p-4 text-center deep-shadow">
                <i class="bi bi-people-fill fs-1 mb-2"></i>
                <h5>عدد المستخدمين</h5>
                <h2 class="glowing-text">{{counterAllUser}}</h2>
                <small class="text-success">اجمالي عدد المستخدمين</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat p-4 text-center deep-shadow">
                <i class="bi bi-person-badge-fill fs-1 mb-2"></i>
                <h5>عدد العملاء</h5>
                <h2>{{counterAllUserClint}}</h2>
                <small class="text-success"> اجمالي عدد العملاء</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat p-4 text-center deep-shadow">
                <i class="bi bi-clipboard-check fs-1 mb-2"></i>
                <h5>طلبات مفتوحة</h5>
                <h2>{{counterAllServiceRequestTrue}}</h2>
                <small class="text-warning">اجمالي الطلبات المقبولة</small>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card card-stat p-4 text-center deep-shadow">
                <i class="bi bi-x-circle-fill fs-1 mb-2"></i>
                <h5>طلبات مرفوضة</h5>
                <h2>{{counterAllServiceRequestFalse}}</h2>
                <small class="text-danger"> اجمالي الطلبات المرفوضة</small>
            </div>
        </div>
    </div>
    <div class="row g-4">
        <div class="col-lg-6 col-md-12">
            <div class="card p-4 deep-shadow chart-card">
                <h5 class="text-primary mb-3"><i class="bi bi-graph-up"></i>&nbsp; &nbsp; توزيع نوع الخدمات</h5>
                <div class="chart-container d-flex justify-content-center">
                    <canvas id="servicesChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-12">
            <div class="card p-4 deep-shadow chart-card">
                <h5 class="text-warning mb-3"><i class="bi bi-star-fill"></i>&nbsp; &nbsp; تقييم المستخدمين</h5>
                <div class="chart-container">
                    <canvas id="ratingsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Users -->
<div id="usersSection" class="section-content" style="display:none;">
    <h3 class="mb-3"><i class="bi bi-people-fill"></i> المستخدمين</h3>
    <button class="btn btn-success mb-3" onclick="openModal('userModal')"><i class="bi bi-plus-circle"></i>&nbsp;إضافة مستخدم</button>
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead><tr><th>Id</th><th>الاسم</th><th>البريد</th><th>الخدمة</th><th>الهاتف</th><th>الخبرة</th><th>الموقع</th><th>إجراءات</th></tr></thead>
            <tbody id="usersTable">
              {% for i in AllUserClintUser %}
              <tr>
                <td>{{i.id}}</td>
                <td>{{i.FullName}}</td>
                <td>{{i.Email}}</td>
                <td>{{i.TypeOfService.ServiceName}}</td>
                <td>{{i.PhoneNumber}}</td>
                <td>{{i.YearsOfExperience}}</td>
                <td>{{i.Location}}</td>
                <td>
                  <a href="{% url 'deleteuser' i.id %}"><button class="btn btn-danger btn-sm">حذف</button></a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Requests -->
<div id="requestsSection" class="section-content" style="display:none;">
    <h3 class="mb-3"><i class="bi bi-clipboard-check"></i> الطلبات</h3>
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead><tr><th>#</th><th>العميل</th><th>المقدم</th><th>الموقع</th><th>السعر/ساعة</th><th>الحالة</th></tr></thead>
            <tbody id="requestsTable">
              {% for i in allServiceRequest %}
              <tr>
                <td>{{i.id}}</td>
                <td>{{i.IdUser.FullName}}</td>
                <td>{{i.IdClient.FullName}}</td>
                <td>{{i.Location}}</td>
                <td>{{i.HourlyPrice}}</td>
                {% if i.ClientOrderStatus == 0 %}
                <td>في الانتضار</td>
                {% elif i.ClientOrderStatus == 1 %}
                <td>تمت</td>
                {% elif i.ClientOrderStatus == 2 %}
                <td>مرفوضة</td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Ratings -->
<div id="ratingsSection" class="section-content" style="display:none;">
    <h3 class="mb-4"><i class="bi bi-star-fill text-warning"></i> التقييمات</h3>
    <div class="row" id="ratingsCards">
    {% for i in userrating %}
<div class="col-md-4 mb-3">
  <div class="card review-card p-3 h-100">

    <div class="d-flex align-items-center mb-2">
      <i class="bi bi-person-circle fs-1 text-primary me-2"></i>&nbsp; &nbsp;
      <div>
        <h6 class="mb-0">{{i.UserId__FullName}}</h6>
        <small class="text-muted">
          {{i.UserId__Email}}
        </small>
      </div>
    </div>
{% comment %} هون وقفت {% endcomment %}
    <div class="rating-stars mb-2">
      &nbsp; &nbsp;
      {% for _ in i.Evaluation|floatformat:0 %}
        <i class="bi bi-star-fill text-warning"></i>
      {% endfor %}

      <small class="ms-2">{{i.Evaluation}}</small>
    </div>
  </div>
</div>
{% endfor %}
    </div>
</div>

<!-- Notifications -->
<div id="notificationsSection" class="section-content" style="display:none;">
    <h3 class="mb-4"><i class="bi bi-bell-fill"></i> الإشعارات</h3>
    <button class="btn btn-success mb-3" onclick="openModal('notificationModal')"><i class="bi bi-plus-circle"></i> إضافة إشعار</button>
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead><tr><th>المستخدم</th><th>العنوان</th><th>الوصف</th><th>نوع الإشعار</th></tr></thead>
            <tbody id="notificationsTable">
              {% for i in AllNotifications %}
              <tr>
                <td>{{i.UserId.FullName}}</td>
                <td>{{i.Title}}</td>
                <td>{{i.Description}}</td>
                {% if i.Isrequest == 1 %}
                <td>اشعار نضام</td>
                {% elif i.Isrequest == 2 %}
                <td>قبول الطلب</td>
                {% elif i.Isrequest == 3 %}
                <td>رفض الطلب</td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!-- Modals -->
<!-- User Modal -->
<div class="modal fade" id="userModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title"><i class="bi bi-person-plus-fill"></i>&nbsp; إضافة/تعديل مستخدم</h5>
      </div>
      <div class="modal-body">
       <form id="userForm" method="post" action="{% url 'AddUser' %}" >
         {% csrf_token %}
      <div class="mb-3"><label>الاسم</label><input type="text" name="FullName" class="form-control" required ></div>
      <div class="mb-3"><label>البريد</label><input type="email" name="Email" class="form-control" required ></div>
      <div class="mb-3"><label>كلمة المرور</label><input type="password" name="Password" class="form-control" required></div>
      <div class="mb-3"><label>الخدمة</label>
    <select name="TypeOfService" class="form-control" required>
      {% for service in all_services %}
        <option value="{{service.id}}">{{service.ServiceName}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3"><label>الهاتف</label><input type="number" name="PhoneNumber" class="form-control" required></div>
  <div class="mb-3"><label>الخبرة</label><input type="number" name="YearsOfExperience" class="form-control" required></div>
  <div class="mb-3"><label>الموقع</label><input type="text" name="Location" class="form-control" required></div>
  <button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> حفظ</button>
</form>

      </div>
    </div>
  </div>
</div>


<!-- Notification Modal -->
<div class="modal fade" id="notificationModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
      <h5 class="modal-title"><i class="bi bi-plus-circle">&nbsp;</i> إضافة إشعار</h5>
      </div>
    <div class="modal-body">
      <form id="notificationForm" method="post" action="{% url 'AddNotification' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label>المستخدم</label>
          <select name="UserId" class="form-control">
            <option value="AllUser">كل المستخدمين</option>
            {% for i in AllUserClintUser %}
            <option value="{{ i.id }}">{{ i.FullName }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3"><label>العنوان</label><input name="Title" type="text" class="form-control" required></div>
        <div class="mb-3"><label>الوصف</label><textarea name="Description" class="form-control"></textarea></div>
        <button type="submit" class="btn btn-success"><i class="bi bi-check-circle"></i> حفظ</button>
      </form>
    </div>
  </div>
</div>
</div>


{{ chart_data|json_script:"chart-data" }}
<script>
  var chartData = JSON.parse(document.getElementById('chart-data').textContent);
</script>

{{ userrating|json_script:"userrating-data" }}
<script>
  var userrating = JSON.parse(document.getElementById('userrating-data').textContent);
</script>

<script>

window.addEventListener('load', () => {
    const hash = window.location.hash.replace('#', '');
    if(hash) {
        showSection(hash);
    }
});


const sidebar = document.getElementById('sidebar');
document.getElementById('sidebarToggle').addEventListener('click', ()=> {
    sidebar.classList.toggle('show');
});

// دالة لإظهار الأقسام مع تأثيرات
function showSection(section){
    // إخفاء جميع الأقسام
    ['homeSection','usersSection','requestsSection','ratingsSection','notificationsSection'].forEach(id=>{
        const el = document.getElementById(id);
        el.style.display = 'none';
        el.classList.remove('section-active');
    });
    
    // إزالة النشاط من جميع الروابط
    document.querySelectorAll('#sidebar .nav-link').forEach(e=>e.classList.remove('active'));
    
    // إظهار القسم المحدد مع تأثير
    setTimeout(() => {
        const activeSection = document.getElementById(section+'Section');
        activeSection.style.display = 'block';
        setTimeout(() => {
            activeSection.classList.add('section-active');
        }, 50);
    }, 300);
    
    // إضافة النشاط للرابط المحدد
    document.querySelector(`#sidebar .nav-link[onclick="showSection('${section}')"]`).classList.add('active');
}

function openModal(id){new bootstrap.Modal(document.getElementById(id)).show();}


const ratings=[
{id:userrating[0].id , name:userrating[0].UserId__FullName  ,rating:userrating[0].Evaluation }
,{id:userrating[1].id , name:userrating[1].UserId__FullName  ,rating:userrating[1].Evaluation }
,{id:userrating[2].id , name:userrating[2].UserId__FullName  ,rating:userrating[2].Evaluation }
];

// دالة لإنشاء النجوم
function getStars(r){let s='';for(let i=1;i<=5;i++){s+=`<i class="bi ${i<=Math.floor(r)?'bi-star-fill':'bi-star'}"></i>`;} return s;}


// الرسوم البيانية
new Chart(document.getElementById('servicesChart').getContext('2d'),{
type:'doughnut',
data:{
    labels:['حدادين','نجاريين','كهربائيين'],
    datasets:[{
        data: chartData,
        backgroundColor:['#6a11cb','#43e97b','#fa709a'],
        borderWidth: 0,
        hoverOffset: 0
    }]
},
options: {
    responsive: true,
    cutout: '65%',
    plugins: {
        legend: {
            position: 'left',
            rtl: true,
            labels: {
                font: {
                    family: 'Cairo',
                    size: 16
                },
                padding: 26
                
            }
        }
    }
}
});

new Chart(document.getElementById('ratingsChart').getContext('2d'),{
type:'bar',
data:{
    labels:ratings.map(u=>u.name),
    datasets:[{
        label:'التقييم',
        data:ratings.map(u=>u.rating),
        backgroundColor: '#2575fc',
        borderRadius: 10,
        borderSkipped: false,
        maxBarThickness: 40
    }]
},
options:{
    scales:{
        y:{
            beginAtZero:true,
            max:5,
            grid: {
                color: 'rgba(0, 0, 0, 0.05)'
            }
        },
        x: {
            grid: {
                display: false
            }
        }
    },
    plugins: {
        legend: {
            display: false
        }
    }
}
});

// دالة لتبديل الوضع الليلي
function toggleDarkMode() {
    const body = document.body;
    const themeIcon = document.getElementById('theme-icon');
    
    body.classList.toggle('dark-mode');
    
    if (body.classList.contains('dark-mode')) {
        themeIcon.classList.remove('bi-moon-fill');
        themeIcon.classList.add('bi-sun-fill');
    } else {
        themeIcon.classList.remove('bi-sun-fill');
        themeIcon.classList.add('bi-moon-fill');
    }
}

// تأثيرات عند التمرير
window.addEventListener('scroll', () => {
    const cards = document.querySelectorAll('.card-stat, .review-card');
    cards.forEach(card => {
        const cardTop = card.getBoundingClientRect().top;
        const triggerBottom = window.innerHeight * 0.8;
        
        if (cardTop < triggerBottom) {
            card.style.opacity = 1;
            card.style.transform = 'translateY(0)';
        }
    });
});

// تهيئة العناصر مع تأثيرات
document.querySelectorAll('.card-stat, .review-card').forEach(card => {
    card.style.opacity = 0;
    card.style.transform = 'translateY(20px)';
    card.style.transition = 'all 0.5s ease';
});

// تفعيل تأثيرات التمرير عند التحميل
window.addEventListener('load', () => {
    setTimeout(() => {
        const cards = document.querySelectorAll('.card-stat, .review-card');
        cards.forEach((card, index) => {
            setTimeout(() => {
                const cardTop = card.getBoundingClientRect().top;
                const triggerBottom = window.innerHeight * 0.8;
                
                if (cardTop < triggerBottom) {
                    card.style.opacity = 1;
                    card.style.transform = 'translateY(0)';
                }
            }, index * 100);
        });
    }, 500);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>